WITH ai_events AS (SELECT ue.profile_id,ue.position_id,ue.created_at ai_ts FROM amgen_user_calendar_events ue WHERE ue.group_id='amgen.com' AND ue.interview_slots_json[0].interviewers[0].is_ai_interviewer=TRUE AND ue.created_at>=CURRENT_DATE-INTERVAL '90 days'),apps AS (SELECT a.application_id,a.profile_id,a.position_id,a.application_ts,a.status application_status,a.last_stage,a.last_stage_ts FROM amgen_applications a WHERE a.group_id='amgen.com'),positions AS (SELECT position_id,recruiter_name,recruiter,location_country,status FROM amgen_positions WHERE group_id='amgen.com' AND location_country='India' AND UPPER(status)='OPEN') SELECT (p.recruiter_name) AS recruiter_name,(p.recruiter) AS recruiter_email,COUNT(DISTINCT CASE WHEN ae.position_id IS NOT NULL THEN ae.profile_id||'-'||ae.position_id END) AS ai_interview_count,COUNT(DISTINCT CASE WHEN ae.position_id IS NOT NULL THEN ae.profile_id||'-'||ae.position_id WHEN ap.last_stage<>'REVIEW' AND ae.position_id IS NULL THEN ap.profile_id||'-'||ap.position_id END) AS eligible_applications,COUNT(DISTINCT CASE WHEN ap.last_stage<>'REVIEW' AND ae.position_id IS NULL THEN ap.profile_id||'-'||ap.position_id END) AS missed_opportunities,ROUND(100.0*COUNT(DISTINCT CASE WHEN ae.position_id IS NOT NULL THEN ae.profile_id||'-'||ae.position_id END)/NULLIF(COUNT(DISTINCT CASE WHEN ae.position_id IS NOT NULL THEN ae.profile_id||'-'||ae.position_id WHEN ap.last_stage<>'REVIEW' AND ae.position_id IS NULL THEN ap.profile_id||'-'||ap.position_id END),0),2) AS ai_adoption_percentage FROM positions p LEFT JOIN ai_events ae ON ae.position_id=p.position_id LEFT JOIN apps ap ON ap.position_id=p.position_id AND (ap.profile_id=ae.profile_id OR ae.profile_id IS NULL) GROUP BY p.recruiter_name,p.recruiter ORDER BY ai_adoption_percentage DESC;